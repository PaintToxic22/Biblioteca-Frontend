<div class="admin-container">
  <header class="admin-header">
    <div class="header-left">
      <h1>‚öôÔ∏è Panel Administrativo</h1>
      <p>{{ userName() }}</p>
    </div>
    <button (click)="logout()" class="logout-btn">Cerrar Sesi√≥n</button>
  </header>

  <nav class="tabs">
    <button 
      [class.active]="activeTab() === 'dashboard'"
      (click)="switchTab('dashboard')"
      class="tab-btn">
      üìä Dashboard
    </button>
    <button 
      [class.active]="activeTab() === 'books'"
      (click)="switchTab('books')"
      class="tab-btn">
      üìö Gestionar Libros
    </button>
    <button 
      [class.active]="activeTab() === 'loans'"
      (click)="switchTab('loans')"
      class="tab-btn">
      üì§ Pr√©stamos
    </button>
    <button 
      [class.active]="activeTab() === 'users'"
      (click)="switchTab('users')"
      class="tab-btn">
      üë• Usuarios
    </button>
  </nav>

  <div class="content">
    <!-- DASHBOARD -->
    <div *ngIf="activeTab() === 'dashboard'" class="tab-content">
      <h2>Dashboard</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìö</div>
          <div class="stat-info">
            <div class="stat-label">Total de Libros</div>
            <div class="stat-value">{{ totalBooks() }}</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üì§</div>
          <div class="stat-info">
            <div class="stat-label">Pr√©stamos Activos</div>
            <div class="stat-value">{{ activeLoans() }}</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìã</div>
          <div class="stat-info">
            <div class="stat-label">Total de Pr√©stamos</div>
            <div class="stat-value">{{ totalLoans() }}</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-info">
            <div class="stat-label">Total de Usuarios</div>
            <div class="stat-value">{{ totalUsers() }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- BOOKS MANAGEMENT -->
    <div *ngIf="activeTab() === 'books'" class="tab-content">
      <div class="section-container">
        <div class="form-section">
          <h2>{{ editingBookId() ? '‚úèÔ∏è Editar Libro' : '‚ûï Agregar Nuevo Libro' }}</h2>
          <form (ngSubmit)="saveBook()" class="book-form">
            <div class="form-row">
              <div class="form-group">
                <label>T√≠tulo *</label>
                <input 
                  type="text" 
                  [(ngModel)]="newBook().titulo"
                  name="titulo"
                  placeholder="Ej: Don Quijote"
                  required>
              </div>
              <div class="form-group">
                <label>Autor *</label>
                <input 
                  type="text" 
                  [(ngModel)]="newBook().autor"
                  name="autor"
                  placeholder="Ej: Miguel de Cervantes"
                  required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>ISBN *</label>
                <input 
                  type="text" 
                  [(ngModel)]="newBook().isbn"
                  name="isbn"
                  placeholder="Ej: 978-8408175560"
                  required>
              </div>
              <div class="form-group">
                <label>A√±o *</label>
                <input 
                  type="number" 
                  [(ngModel)]="newBook().anio"
                  name="anio"
                  required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Categor√≠a *</label>
                <input 
                  type="text" 
                  [(ngModel)]="newBook().categoria"
                  name="categoria"
                  placeholder="Ej: Novela"
                  required>
              </div>
              <div class="form-group">
                <label>Editorial</label>
                <input 
                  type="text" 
                  [(ngModel)]="newBook().editorial"
                  name="editorial"
                  placeholder="Ej: Penguin">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Total de Copias</label>
                <input 
                  type="number" 
                  [(ngModel)]="newBook().total"
                  name="total"
                  min="1">
              </div>
            </div>

            <div class="form-group full-width">
              <label>Descripci√≥n</label>
              <textarea 
                [(ngModel)]="newBook().descripcion"
                name="descripcion"
                placeholder="Descripci√≥n del libro"
                rows="4"></textarea>
            </div>

            <div class="form-actions">
              <button type="submit" [disabled]="loading()" class="btn-primary">
                {{ editingBookId() ? '‚úèÔ∏è Actualizar Libro' : '‚ûï Crear Libro' }}
              </button>
              <button 
                type="button" 
                (click)="resetBookForm()"
                *ngIf="editingBookId()"
                class="btn-secondary">
                Cancelar
              </button>
            </div>
          </form>
        </div>

        <div class="list-section">
          <h2>üìö Libros Registrados</h2>
          <div *ngIf="loading()" class="loading">Cargando libros...</div>
          <div *ngIf="!loading() && books().length === 0" class="empty">
            No hay libros registrados
          </div>
          <table class="data-table" *ngIf="!loading() && books().length > 0">
            <thead>
              <tr>
                <th>T√≠tulo</th>
                <th>Autor</th>
                <th>ISBN</th>
                <th>A√±o</th>
                <th>Categor√≠a</th>
                <th>Total</th>
                <th>Disponibles</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let book of books()">
                <td><strong>{{ book.titulo }}</strong></td>
                <td>{{ book.autor }}</td>
                <td>{{ book.isbn }}</td>
                <td>{{ book.anio }}</td>
                <td><span class="badge">{{ book.categoria }}</span></td>
                <td>{{ book.total }}</td>
                <td>
                  <span [class]="book.disponibles > 0 ? 'badge-success' : 'badge-danger'">
                    {{ book.disponibles }}
                  </span>
                </td>
                <td class="actions">
                  <button (click)="editBook(book)" class="btn-edit">‚úèÔ∏è</button>
                  <button (click)="deleteBook(book._id)" class="btn-delete">üóëÔ∏è</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- LOANS MANAGEMENT -->
    <div *ngIf="activeTab() === 'loans'" class="tab-content">
      <h2>üì§ Gesti√≥n de Pr√©stamos</h2>
      <div *ngIf="loading()" class="loading">Cargando pr√©stamos...</div>
      <div *ngIf="!loading() && loans().length === 0" class="empty">
        No hay pr√©stamos registrados
      </div>
      <table class="data-table" *ngIf="!loading() && loans().length > 0">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Libro</th>
            <th>Fecha Pr√©stamo</th>
            <th>Fecha L√≠mite</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let loan of loans()" [class]="'status-' + loan.estado">
            <td>{{ loan.usuarioId?.name || 'N/A' }}</td>
            <td>{{ loan.libroId?.titulo || 'N/A' }}</td>
            <td>{{ loan.createdAt | date: 'short' }}</td>
            <td>{{ loan.fechaLimite | date: 'short' }}</td>
            <td>
              <span [class]="'badge-' + loan.estado">
                {{ loan.estado | uppercase }}
              </span>
            </td>
            <td class="actions">
              <button 
                *ngIf="loan.estado === 'activo'"
                (click)="returnBook(loan._id)" 
                class="btn-success">
                ‚úì Marcar Devuelto
              </button>
              <span *ngIf="loan.estado !== 'activo'" class="text-muted">
                -
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- USERS MANAGEMENT -->
    <div *ngIf="activeTab() === 'users'" class="tab-content">
      <h2>üë• Gesti√≥n de Usuarios</h2>
      <div *ngIf="loading()" class="loading">Cargando usuarios...</div>
      <div *ngIf="!loading() && users().length === 0" class="empty">
        No hay usuarios registrados
      </div>
      <table class="data-table" *ngIf="!loading() && users().length > 0">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Carn√© ID</th>
            <th>Registrado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users()">
            <td><strong>{{ user.name }}</strong></td>
            <td>{{ user.email }}</td>
            <td>
              <span [class]="'role-' + user.role">
                {{ user.role === 'admin' ? '‚öôÔ∏è Admin' : 'üë§ Estudiante' }}
              </span>
            </td>
            <td>{{ user.carnetId || '-' }}</td>
            <td>{{ user.createdAt | date: 'short' }}</td>
            <td class="actions">
              <button 
                *ngIf="user.role !== 'admin'"
                (click)="deleteUser(user._id)" 
                class="btn-delete">
                üóëÔ∏è
              </button>
              <span *ngIf="user.role === 'admin'" class="text-muted">-</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>